---
title: "Proyecto en Grupo"
author: "Natalia Fitipaldi, Matías Muñoz, Pedro Milat, Mateo Pérez"
date: "Julio 2021"
output:
  pdf_document:
    latex_engine: xelatex
  fig_caption: true
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy.opts = list(width.cutoff = 50), tidy = TRUE, fig.pos = 'h', out.extra = '', message = FALSE, warning = FALSE)
```


## Introducción

El presente documento contiene el resultado del trabajo final de Nuevas Tecnologías para el Análisis Estadístico de Datos cuyo objetivo es utilizar adecuadamente las herramientas computacionales aprendidas en clase para realizar el análisis exploratorio de unos datos de interés.  
El análisis tendrá por objetivo obtener una descripción en términos estadísticos sobre los datos bajo estudio, así como plantear y responder preguntas de interés que formarán parte del problema a resolver.  
Este estudio se hará mediante la elaboración de gráficos y resúmenes sobre las variables relevantes que componen la base de información así como también el planteo de una aplicación web en shiny.

## Conjunto de datos

Esta análisis se va a basar en datos referentes a personas fallecidas en siniestros de tránsito en nuestro país, entre los años 2013 a 2019, extraídos del catálogo de datos de Uruguay (https://catalogodatos.gub.uy/dataset/unasev-fallecidos_siniestros_transito).
Juntamos los datos de cada año para así poder realizar alguna pregunta temporal y ver si con el paso del tiempo existe algún cambio notorio.
Los datos con los que trabajaremos tienen 3477 observaciones y 14 variables, entre las cuales tenemos discretas, continuas y categóricas.

## Preguntas:

###   * Evolución en el tiempo de la cantidad de fallecidos en accidentes de tránsito
###   * Mapa departamental con la cantidad de fallecidos en accidentes de tránsito entre 2013 y 2019
###   * Correlación entre el rol y el sexo??? 

```{r data, echo = FALSE}
library(gapminder)
library(tidyverse)
library(here)
library(lubridate)
library(rgdal)
library(xtable)

Datos <- read_csv(here("Accidentes_transito_2013a2019.csv"))
```

\newpage

## Evolución en el tiempo de la cantidad de fallecidos en accidentes de tránsito
 
```{r temporal, echo = FALSE}

f <- Datos %>% 
  mutate(Fecha_y_hora = dmy_hm(`Fecha y hora`)) %>% 
  mutate(Ano = year(Fecha_y_hora)) %>% 
  mutate(Mes = month(Fecha_y_hora)) %>% 
  group_by(Ano, Mes) %>% 
  summarise(cantidad = n())

ggplot(data = f, aes(x = Mes, y = cantidad, colour = as.factor(Ano))) +
  geom_line(size = 1) +
  geom_point(size = 1.5) +
  facet_wrap( ~Ano) +
  scale_color_brewer(palette = "Dark2", guide = "none") +
  scale_x_discrete(limit = c(1:12), labels = c("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Setiembre", "Octubre", "Noviembre", "Diciembre")) +
  theme(axis.text.x = element_text(angle = 90),
        text = element_text(size = 10)) +
  labs(x = "Mes", y = "Cantidad", title = "Evolución temporal de la cantidad de accidentes")

```

\newpage

## Mapa departamental con la cantidad de fallecidos en accidentes de tránsito entre 2013 y 2019
```{r mapa, echo = FALSE,message=FALSE, results="asis"}

mapaine <- readOGR(here("ine_depto.shp"),verbose = FALSE)

dframe_depto <- ggplot2::fortify(mapaine)

deptos <- dframe_depto %>%
rename(Departamento = id) %>%
mutate(Departamento=recode(Departamento, `0` = "MONTEVIDEO",
`8` = "RIO NEGRO", `9` = "RIVERA",`7`="PAYSANDU",
`1`="ARTIGAS",`2`="CANELONES",`19`="CERRO LARGO",
`3`="COLONIA",`4`="DURAZNO",`5`="FLORIDA",`6`="LAVALLEJA",
`10`="ROCHA",`11`="SALTO", `12`="SAN JOSE",`13`="SORIANO",
`14`="TREINTA Y TRES", `16`="TACUAREMBO",`17`="FLORES",
`18`="MALDONADO"))


tabla <- Datos %>%
group_by(Departamento) %>%
summarise(n=n()) %>%
mutate(prop = n/sum(n, na.rm = TRUE)) %>%
rename(Cantidad = n, Proporción = prop)

mapauru <- left_join(deptos, tabla, by = "Departamento")

mapauru %>%
filter(Departamento!=15) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Cantidad)) +
  scale_fill_viridis_c() +
  labs(x="Longitud", y="Latitud",fill="Cantidad de accidentes",
       title="Cantidad de accidentes por departamento")

options(xtable.comment = FALSE)

tabla %>% xtable() %>% print(include.rownames = FALSE)
```

\newpage

## Correlación entre el Rol y el Sexo
```{r, echo=FALSE}
Datos %>%
  filter(!is.na(Sexo)) %>%
  group_by(`Rol`,Sexo) %>%
  summarise(cant =n()) %>%
  ggplot(aes(x = `Rol`, y = cant, fill = Sexo)) +
    geom_bar(stat="identity", position = "dodge") +
    scale_fill_brewer(palette = "Set1") +
    labs(y = "Cantidad", title = "Cantidad de accidentes según el rol de la persona", subtitle = "Diferenciado por sexo")

```
