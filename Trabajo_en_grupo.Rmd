---
title: "Proyecto en Grupo"
author: "Natalia Fitipaldi, Matías Muñoz, Pedro Milat, Mateo Pérez"
date: "Julio 2021"
output:
  pdf_document:
    latex_engine: xelatex
  fig_caption: true
---


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, tidy.opts = list(width.cutoff = 50), tidy = TRUE, fig.pos = 'h', out.extra = '', message = FALSE, warning = FALSE)
```


## Introducción

El presente documento contiene el resultado del trabajo final de Nuevas Tecnologías para el Análisis Estadístico de Datos cuyo objetivo es utilizar adecuadamente las herramientas computacionales aprendidas en clase para realizar el análisis exploratorio de unos datos de interés.  
El análisis tendrá por objetivo obtener una descripción en términos estadísticos sobre los datos bajo estudio, así como plantear y responder preguntas de interés que formarán parte del problema a resolver.  
Este estudio se hará mediante la elaboración de gráficos y resúmenes sobre las variables relevantes que componen la base de información así como también el planteo de una aplicación web en shiny.

## Conjunto de datos

Esta análisis se va a basar en datos referentes a personas fallecidas en siniestros de tránsito en nuestro país, entre los años 2013 a 2019, extraídos del catálogo de datos de Uruguay (https://catalogodatos.gub.uy/dataset/unasev-fallecidos_siniestros_transito).
Juntamos los datos de cada año para así poder realizar alguna pregunta temporal y ver si con el paso del tiempo existe algún cambio notorio.
Los datos con los que trabajaremos tienen 3477 observaciones y 14 variables, entre las cuales tenemos discretas, continuas y categóricas.

## Preguntas:

###   * ¿La cantidad de fallecidos en accidentes de tránsito aumenta en algún período específico a lo largo de los años?
###   * En los años 2013 a 2019, ¿cuáles fueron los departamentos que han sufrido mayores accidentes de tránsito, y cuáles fueron los que han sufrido menos?
###   * ¿Existe una correlación entre el rol que cumplía la persona fallecida y el sexo de la misma? 

```{r data, echo = FALSE}
library(gapminder)
library(tidyverse)
library(here)
library(lubridate)
library(rgdal)
library(xtable)

Datos <- read_csv(here("Accidentes_transito_2013a2019.csv"))
```

\newpage

## ¿La cantidad de fallecidos en accidentes de tránsito aumenta en algún período específico a lo largo de los años?
 
```{r temporal, echo = FALSE, fig.cap="Lo que se observa en el gráfico es que no hay relación entre la cantidad de accidentes y los años. En todos los años hay una gran variación de accidentes, donde aparecen picos altos y bajos en los distintos meses del año. La cantidad de accidentes es irregular durante un mismo año." }

f <- Datos %>% 
  mutate(Fecha_y_hora = dmy_hm(`Fecha y hora`)) %>% 
  mutate(Ano = year(Fecha_y_hora)) %>% 
  mutate(Mes = month(Fecha_y_hora)) %>% 
  group_by(Ano, Mes) %>% 
  summarise(cantidad = n())

ggplot(data = f, aes(x = Mes, y = cantidad, colour = as.factor(Ano))) +
  geom_line(size = 1) +
  geom_point(size = 1.5) +
  facet_wrap( ~Ano) +
  scale_color_brewer(palette = "Dark2", guide = "none") +
  scale_x_discrete(limit = c(1:12),
                   labels = c("Enero", "Febrero", "Marzo", "Abril",
                              "Mayo", "Junio", "Julio", "Agosto",
                              "Setiembre", "Octubre", "Noviembre",
                              "Diciembre")) +
  theme(axis.text.x = element_text(angle = 90),
        text = element_text(size = 10)) +
  labs(x = "Mes", y = "Cantidad", 
       title = "Evolución temporal de la cantidad de accidentes")

```

\newpage

Nuevos datos para ver si el descenso en la movilidad debido a la pandemia disminuyó el número de fallecidos por accidentes de tránsito.

```{r}
#Datos por accidentes
Montevideo2020 <- read_csv(here("Datos/Montevideo2020.txt"))
Dptos2020 <- read.csv(here("Datos/Dptos2020.txt"))
Montevideo2021 <- read_csv(here("Datos/Montevideo2021.txt"))
Dptos2021 <- read.csv(here("Datos/Dptos2021.txt"))
```

```{r}
names(Montevideo2020) <- names(Dptos2020)
names(Montevideo2021) <- names(Dptos2021)

datos_20_21 <- rbind(Montevideo2020, Dptos2020,
                     Montevideo2021, Dptos2021)
```

```{r}
personas_mdeo_2020 <- read_csv(here("Datos/personas_mdeo_2020.txt"))
personas_dptos_2020 <- read_csv(here("Datos/personas_dptos_2020.txt"))

personas_2020 <- rbind(personas_mdeo_2020, personas_dptos_2020)
```

```{r}
#Nos quedamos con aquellas observaciones que tienen como Tipo de resultado a FALLECIDO EN CENTRO DE ASISTENCIA o FALLECIDO EN EL LUGAR
fallecidos_2020 <-  personas_2020[grepl("FALLECIDO+", personas_2020$`Tipo de resultado`), ]
```

```{r}
f_2020 <- fallecidos_2020 %>% 
  mutate(Fecha = dmy(Fecha)) %>% 
  mutate(Ano = year(Fecha)) %>% 
  mutate(Mes = month(Fecha)) %>% 
  group_by(Ano, Mes) %>% 
  summarise(cantidad = n())

f_total <- rbind(f, f_2020) 

f_total$mes_año <- my(paste(f_total$Mes, f_total$Ano, sep = "-"))
```


```{r,fig.cap="Podemos apreciar que alrededor de marzo de 2020, momento en el cual empezó la pandemia, la cantidad de accidentes de tránsito tiene un gran descenso, debido probablemente a la disminución de movilidad antes mencionada."}
ggplot(data = f_total, aes(x = mes_año, y = cantidad)) +
  geom_line(size = 1, color = "blue") +
  geom_point(size = 1.5) +
  scale_color_brewer(palette = "Dark2", guide = "none") +
  theme(axis.text.x = element_text(angle = 90),
        text = element_text(size = 10)) +
  labs(x = "Fecha", y = "Cantidad", 
       title = "Evolución temporal de la cantidad de accidentes") +
  theme_bw()
```





\newpage

## En los años 2013 a 2019, ¿cuáles fueron los departamentos que han sufrido mayores accidentes de tránsito, y cuáles fueron los que han sufrido menos?

```{r mapa, echo = FALSE,message=FALSE, results="asis", fig.cap= "Los departamentos con más accidentes son Montevideo y Canelones, con 915 y 686 accidentes respectivamente. Entre los dos departamentos, se acumula el 46 por ciento de accidentes del país. Análogamente, los departamentos con menos accidentes son Treinta y Tres con 44 accidentes, y Flores que acumula un total de 37." }

mapaine <- readOGR(here("ine_depto.shp"),verbose = FALSE)

dframe_depto <- ggplot2::fortify(mapaine)

deptos <- dframe_depto %>%
rename(Departamento = id) %>%
mutate(Departamento=recode(Departamento, `0` = "MONTEVIDEO",
`8` = "RIO NEGRO", `9` = "RIVERA",`7`="PAYSANDU",
`1`="ARTIGAS",`2`="CANELONES",`19`="CERRO LARGO",
`3`="COLONIA",`4`="DURAZNO",`5`="FLORIDA",`6`="LAVALLEJA",
`10`="ROCHA",`11`="SALTO", `12`="SAN JOSE",`13`="SORIANO",
`14`="TREINTA Y TRES", `16`="TACUAREMBO",`17`="FLORES",
`18`="MALDONADO"))


tabla <- Datos %>%
group_by(Departamento) %>%
summarise(n=n()) %>%
mutate(prop = n/sum(n, na.rm = TRUE)) %>%
rename(Cantidad = n, Proporción = prop)

mapauru <- left_join(deptos, tabla, by = "Departamento")

mapauru %>%
filter(Departamento!=15) %>%
ggplot(aes(x = long, y = lat, group = group)) +
geom_polygon(aes(fill = Cantidad)) +
  scale_fill_viridis_c() +
  labs(x="Longitud", y="Latitud",fill="Cantidad de accidentes",
       title="Cantidad de accidentes por departamento")

options(xtable.comment = FALSE)

tabla %>% xtable() %>% print(include.rownames = FALSE)
```

\newpage

## ¿Existe una correlación entre el rol que cumplía la persona fallecida y el sexo de la misma? 

```{r, echo=FALSE, fig.cap= "La conclusión del gráfico es que la mayor cantidad de accidentes ocurren por causa del conductor. Dentro de este rol, notamos la amplia diferencia entre la cantidad de conductores hombres contra la cantidad de accidentes de conductoras mujeres. El hombre genera, aproximadamente, 8 veces más accidentes que lo que generan las mujeres. Con respecto a los otros roles, vemos que en el rubro pasajero es mayor la influencia de la mujer mientras que en el rubro peatón, el hombre supera a la mujer."}

Datos %>%
  filter(!is.na(Sexo)) %>%
  group_by(`Rol`,Sexo) %>%
  summarise(cant =n()) %>%
  ggplot(aes(x = `Rol`, y = cant, fill = Sexo)) +
    geom_bar(stat="identity", position = "dodge") +
    scale_fill_brewer(palette = "Set1") +
    labs(y = "Cantidad", 
         title = "Cantidad de accidentes según el rol de la persona",
         subtitle = "Diferenciado por sexo")

```


